{% extends "index.html" %}
{% load static %}

{% block current_page %}Cart{% endblock current_page %}

{% block body %}
{% block navigation %}
{{ block.super }}
{% endblock navigation %}

<!-- HERO SECTION -->
<section class="hero-wrap hero-wrap-2" style="background-image: url({% static 'assets/images/bg_2.jpg' %});" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text align-items-end justify-content-center">
      <div class="col-md-9 ftco-animate mb-5 text-center">
        <p class="breadcrumbs mb-0">
          <span class="mr-2">
            <a href="{% url 'index' %}">Home <i class="fa fa-chevron-right"></i></a>
          </span>
          <span>Cart <i class="fa fa-chevron-right"></i></span>
        </p>
        <h2 class="mb-0 bread">My Cart</h2>
      </div>
    </div>
  </div>
</section>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

{% if messages %}
<div class="container mt-3">
  {% for message in messages %}
    <div class="custom-alert {{ message.tags }} show">
      <i class="fa-solid fa-circle-check"></i> {{ message }}
      <span class="close-alert">&times;</span>
    </div>
  {% endfor %}
</div>
{% endif %}


<!-- CART SECTION -->
<section class="ftco-section">
  <div class="container">
    <div class="row">
      <div class="table-wrap">
        <table class="table">
          <thead class="thead-primary">
            <tr>
              <th>&nbsp;</th>
              <th>&nbsp;</th>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
              <th>&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart_items %}
            <tr class="alert" role="alert">
              <td>
                <label class="checkbox-wrap checkbox-primary">
                  <input type="checkbox" checked>
                  <span class="checkmark"></span>
                </label>
              </td>
              <td>
                <div class="img" style="background-image: url('{{ item.image }}');"></div>
              </td>
              <td>
                <div class="email">
                  <span>{{ item.name }}</span>
                </div>
              </td>
              <td>Ksh {{ item.price }}</td>
              <td class="quantity">
                <div class="input-group">
                  <input type="text" name="quantity" class="quantity form-control input-number" value="{{ item.quantity }}" min="1" max="100" readonly>
                </div>
              </td>
              <td>Ksh {{ item.item_total }}</td>
              <td>
                <a href="{% url 'remove_from_cart' item.id %}" class="close">
                  <span aria-hidden="true"><i class="fa fa-close"></i></span>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center">Your cart is empty.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Cart Totals -->
    <div class="row justify-content-end">
      <div class="col col-lg-5 col-md-6 mt-5 cart-wrap ftco-animate">
        <div class="cart-total mb-3">
          <h3>Cart Totals</h3>
          <p class="d-flex">
            <span>Subtotal</span>
            <span>Ksh {{ total_price }}</span>
          </p>
          <p class="d-flex">
            <span>Delivery</span>
            <span>Ksh 0.00</span>
          </p>
          <p class="d-flex">
            <span>Discount</span>
            <span>Ksh 0.00</span>
          </p>
          <hr>
          <p class="d-flex total-price">
            <span>Total</span>
            <span>Ksh {{ total_price }}</span>
          </p>
        </div>
        <p class="text-center">
          <a href="{% url 'checkout' %}" class="btn btn-primary py-3 px-4">Proceed to Checkout</a>
        </p>
      </div>
    </div>
  </div>
</section>

<!-- CUSTOM STYLE -->
<style>
.img {
  width: 80px;
  height: 80px;
  background-size: cover;
  background-position: center;
  border-radius: 5px;
}

.quantity input {
  width: 60px;
  text-align: center;
}

.cart-total h3 {
  font-weight: bold;
}

.total-price span {
  font-weight: bold;
  font-size: 18px;
}

.alert .close {
  cursor: pointer;
  color: #ff7a00;
}
/* Custom Beautiful Alerts */
.custom-alert {
  padding: 15px 20px;
  margin-bottom: 15px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  animation: slideDown 0.5s ease;
  position: relative;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
  color: #fff;
}

.custom-alert i {
  margin-right: 10px;
}

/* Success */
.custom-alert.success {
  background: linear-gradient(135deg, #00f138, #00ff3c);
}

/* Error */
.custom-alert.error {
  background: linear-gradient(135deg, #dc3545, #e4606d);
}

/* Warning */
.custom-alert.warning {
  background: linear-gradient(135deg, #ffc107, #ffcd39);
  color: #333;
}

/* Info */
.custom-alert.info {
  background: linear-gradient(135deg, #0df01c, #31d2f2);
}

.close-alert {
  cursor: pointer;
  font-size: 22px;
  font-weight: bold;
  color: #fff;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Fade out on click */
.custom-alert.fade-out {
  animation: fadeOut 0.4s forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

</style>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const alerts = document.querySelectorAll(".custom-alert");

    alerts.forEach(alert => {
      const closeBtn = alert.querySelector(".close-alert");

      // Close when X is clicked
      closeBtn.addEventListener("click", () => {
        alert.classList.add("fade-out");
        setTimeout(() => alert.remove(), 400);
      });

      // Auto close after 4 seconds
      setTimeout(() => {
        alert.classList.add("fade-out");
        setTimeout(() => alert.remove(), 400);
      }, 4000);
    });
  });
</script>

{% block footer %}
{{ block.super }}
{% endblock footer %}

{% endblock body %}
