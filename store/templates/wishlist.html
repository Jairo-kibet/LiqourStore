{% extends "index.html" %}
{% load static %}

{% block current_page %}Wishlist{% endblock current_page %}

{% block body %}
{% block navigation %}
{{ block.super }}
{% endblock navigation %}



<!-- HERO SECTION -->
<section class="hero-wrap hero-wrap-2" style="background-image: url({% static 'assets/images/bg_2.jpg' %});" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text align-items-end justify-content-center">
      <div class="col-md-9 ftco-animate mb-5 text-center">
        <p class="breadcrumbs mb-0">
          <span class="mr-2">
            <a href="{% url 'index' %}">Home <i class="fa fa-chevron-right"></i></a>
          </span>
          <span>Wishlist <i class="fa fa-chevron-right"></i></span>
        </p>
        <h2 class="mb-0 bread">Wishlist</h2>
      </div>
    </div>
  </div>
</section>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

{% if messages %}
<div class="messages-wrapper">
  {% for message in messages %}
    <div class="msg-card msg-{{ message.tags }}">
      <span class="msg-icon">
        {% if message.tags == "success" %}
          <i class="fa-solid fa-circle-check"></i>
        {% elif message.tags == "error" or message.tags == "danger" %}
          <i class="fa-solid fa-circle-xmark"></i>
        {% elif message.tags == "warning" %}
          <i class="fa-solid fa-triangle-exclamation"></i>
        {% else %}
          <i class="fa-solid fa-circle-info"></i>
        {% endif %}
      </span>

      <span class="msg-text">{{ message }}</span>

      <button class="msg-close" onclick="this.parentElement.remove();">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
  {% endfor %}
</div>
{% endif %}



<!-- WISHLIST SECTION -->
<section class="ftco-section">
  <div class="container-fluid">
    <div class="whiskey-grid text-center">

      {% for item in items %}
      <div class="whiskey-item">
        <div class="product ftco-animate">

          <!-- Product Image -->
          <div class="img d-flex align-items-center justify-content-center"
               style="background-image: url('{{ item.whiskey.image.url }}');"></div>

          <!-- Product Content -->
          <div class="text text-center product-details">

            {% if item.whiskey.sale_price %}
              <span class="sale">Sale</span>
            {% endif %}

            <!-- Category | ABV -->
            <p class="text-muted category-abv">
              {{ item.whiskey.category|default:"Whiskey" }} | {{ item.whiskey.abv }}
            </p>

            <!-- Name -->
            <h3 class="whiskey-name">{{ item.whiskey.name }}</h3>

            <!-- Volume | Price -->
            <p class="volume-price">
              {{ item.whiskey.volume }} |
              <span>Ksh {{ item.whiskey.sale_price|default:item.whiskey.price }}</span>
            </p>

            {% if item.whiskey.description %}
              <p class="whiskey-desc">{{ item.whiskey.description }}</p>
            {% endif %}

            <!-- ICONS -->
            <div class="d-flex justify-content-center mt-3 icon-buttons">

              <!-- Add to Cart -->
              <form action="{% url 'add_to_cart' item.whiskey.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="icon-btn cart-btn">
                  <i class="fa-solid fa-cart-shopping"></i>
                </button>
              </form>

              <!-- Remove from Wishlist -->
              <form action="{% url 'remove_from_wishlist' item.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="icon-btn wishlist-btn">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </form>

              <!-- Quick View -->
              <button type="button" class="icon-btn"
                      data-bs-toggle="modal" data-bs-target="#quickViewModal{{ item.id }}">
                <i class="fa-regular fa-eye"></i>
              </button>
            </div>

          </div>
        </div>
      </div>

      <!-- QUICK VIEW MODAL -->
      <div class="modal fade" id="quickViewModal{{ item.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">

            <div class="modal-header">
              <h5 class="modal-title">{{ item.whiskey.name }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body d-flex flex-column flex-md-row">
              <div class="modal-img me-md-4 mb-3 mb-md-0" style="flex:1;">
                <img src="{{ item.whiskey.image.url }}" class="img-fluid" style="border-radius:10px;">
              </div>

              <div class="modal-details" style="flex:1;">
                <p class="category-abv">{{ item.whiskey.category|default:"Whiskey" }} | {{ item.whiskey.abv }}</p>
                <h3 class="whiskey-name">{{ item.whiskey.name }}</h3>
                <p class="volume-price">{{ item.whiskey.volume }} | 
                   <span>Ksh {{ item.whiskey.price }}</span></p>

                {% if item.whiskey.description %}
                  <p class="whiskey-desc">{{ item.whiskey.description }}</p>
                {% endif %}

                <div class="d-flex mt-3 gap-3">
                  <form action="{% url 'add_to_cart' item.whiskey.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Add to Cart</button>
                  </form>

                  <form action="{% url 'remove_from_wishlist' item.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Remove</button>
                  </form>
                </div>

              </div>

            </div>
          </div>
        </div>
      </div>

      {% empty %}
        <p class="text-center">No items in your wishlist.</p>
      {% endfor %}

    </div>
  </div>
</section>


<!-- CUSTOM STYLE -->
<style>
/* Whiskey Grid Full Width */
.whiskey-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr); /* exactly 6 items per row */
  gap: 20px;
  width: 100%;
  padding: 0 15px;
  box-sizing: border-box;
}

/* Item and Product styling */
.whiskey-item { display: flex; justify-content: center; }
.product { width: 100%; height: auto; border: 1px solid #e0e0e0; border-radius: 10px; padding: 10px; background: #fff; display: flex; flex-direction: column; align-items: center; }
.product .img { width: 100%; height: 400px; background-size: cover; background-position: center; border-radius: 10px; margin-bottom: 10px; }
.product-details p, .product-details h3 { margin: 2px 0; line-height: 1.2; }

/* Category / ABV */
.category-abv { font-style: italic; color: #888; font-size: 14px; }
.whiskey-name { font-weight: bold; font-size: 16px; color: #222; }
.volume-price { font-size: 14px; color: #333; }
.volume-price span { font-weight: bold; }
.whiskey-desc { font-size: 12px; color: #555; margin-top: 4px; }

/* Icons */
.icon-buttons { gap: 15px; flex-wrap: wrap; }
.icon-buttons .icon-btn { width: 40px; height: 40px; font-size: 18px; color: #333; display: flex; justify-content: center; align-items: center; border: none; background: none; cursor: pointer; transition: 0.3s; }
.icon-buttons .icon-btn:hover { color: orange; transform: scale(1.2); }

/* Sale badge */
.sale { background: #ff0000; color: #fff; padding: 2px 6px; font-size: 12px; border-radius: 5px; display: inline-block; margin-bottom: 5px; }

/* Messages */
/* MESSAGE WRAPPER */
.messages-wrapper {
  width: 100%;
  max-width: 650px;
  margin: 20px auto;
  padding: 0 15px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  z-index: 9999;
}

/* MESSAGE CARD */
.msg-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px 18px;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 500;
  
  color: #e50101;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
  animation: fadeIn 0.4s ease-out;
  position: relative;
}

/* FADE OUT AFTER 4s */
.msg-card.fade-out {
  animation: fadeOut 1s forwards;
}

/* ICON */
.msg-icon {
  font-size: 20px;
}

/* CLOSE BUTTON */
.msg-close {
  background: none;
  border: none;
  color: #fff;
  font-size: 19px;
  cursor: pointer;
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.8;
  transition: 0.3s;
}

.msg-close:hover {
  opacity: 1;
}

/* COLORS FOR DIFFERENT MESSAGE TYPES */
.msg-success { background: #28a745; }
.msg-error, .msg-danger { background: #dc3545; }
.msg-warning { background: #ff9800; }
.msg-info { background: #17a2b8; }

/* ANIMATIONS */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; transform: translateY(-8px); }
}

/* Responsive */
@media (max-width: 1400px) { .whiskey-grid { grid-template-columns: repeat(5, 1fr); } }
@media (max-width: 1200px) { .whiskey-grid { grid-template-columns: repeat(4, 1fr); } }
@media (max-width: 992px)  { .whiskey-grid { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 768px)  { .whiskey-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 480px)  { .whiskey-grid { grid-template-columns: repeat(1, 1fr); } }
</style>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const alerts = document.querySelectorAll('.custom-alert');
    alerts.forEach(alert => {
      setTimeout(() => {
        alert.classList.add('fade-out');
        setTimeout(() => alert.remove(), 1000); // remove from DOM after fade
      }, 4000); // 4 seconds
    });
  });
</script>


{% block footer %}
{{ block.super }}
{% endblock footer %}

{% endblock body %}
